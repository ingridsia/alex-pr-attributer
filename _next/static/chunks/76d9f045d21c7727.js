(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52683,e=>{"use strict";let t,s,r;var n,a,i,o,l,h,c,u,d,p,f,m,g,b,y,w,v,_,x,k,S,R,j,A,M,N,P,T,$,E,I,O,q,W,C,L,U,D,F,X,B,J,V,H,K,G,z,Y,Q,Z,ee,et,es,er,en,ea,ei,eo,el,eh,ec,eu,ed,ep,ef,em,eg=e.i(43476),eb=e.i(71645);function ey(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s}function ew(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}let ev=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return ev=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^s()&15>>e/4).toString(16))};function e_(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let ex=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class ek extends Error{}class eS extends ek{constructor(e,t,s,r){super(`${eS.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.requestID=r?.get("request-id"),this.error=t}static makeMessage(e,t,s){let r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){return e&&r?400===e?new eM(e,t,s,r):401===e?new eN(e,t,s,r):403===e?new eP(e,t,s,r):404===e?new eT(e,t,s,r):409===e?new e$(e,t,s,r):422===e?new eE(e,t,s,r):429===e?new eI(e,t,s,r):e>=500?new eO(e,t,s,r):new eS(e,t,s,r):new ej({message:s,cause:ex(t)})}}class eR extends eS{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class ej extends eS{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eA extends ej{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eM extends eS{}class eN extends eS{}class eP extends eS{}class eT extends eS{}class e$ extends eS{}class eE extends eS{}class eI extends eS{}class eO extends eS{}let eq=/^[a-z][a-z0-9+.-]*:/i,eW=e=>(eW=Array.isArray)(e),eC=eW;function eL(e){return"object"!=typeof e?{}:e??{}}let eU=e=>{try{return JSON.parse(e)}catch(e){return}},eD="0.71.2",eF=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",eX=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function eB(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function eJ(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return eB({start(){},async pull(e){let{done:s,value:r}=await t.next();s?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function eV(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function eH(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let eK=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});function eG(e){let t;return(s??(s=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function ez(e){let t;return(r??(r=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class eY{constructor(){n.set(this,void 0),a.set(this,void 0),ey(this,n,new Uint8Array,"f"),ey(this,a,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?eG(e):e;ey(this,n,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),r=0;for(let t of e)s.set(t,r),r+=t.length;return s}([ew(this,n,"f"),s]),"f");let r=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(ew(this,n,"f"),ew(this,a,"f")));){if(t.carriage&&null==ew(this,a,"f")){ey(this,a,t.index,"f");continue}if(null!=ew(this,a,"f")&&(t.index!==ew(this,a,"f")+1||t.carriage)){r.push(ez(ew(this,n,"f").subarray(0,ew(this,a,"f")-1))),ey(this,n,ew(this,n,"f").subarray(ew(this,a,"f")),"f"),ey(this,a,null,"f");continue}let e=null!==ew(this,a,"f")?t.preceding-1:t.preceding,s=ez(ew(this,n,"f").subarray(0,e));r.push(s),ey(this,n,ew(this,n,"f").subarray(t.index),"f"),ey(this,a,null,"f")}return r}flush(){return ew(this,n,"f").length?this.decode("\n"):[]}}n=new WeakMap,a=new WeakMap,eY.NEWLINE_CHARS=new Set(["\n","\r"]),eY.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let eQ={off:0,error:200,warn:300,info:400,debug:500},eZ=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(eQ,e))return e;e5(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(eQ))}`)}};function e0(){}function e1(e,t,s){return!t||eQ[e]>eQ[s]?e0:t[e].bind(t)}let e2={error:e0,warn:e0,info:e0,debug:e0},e4=new WeakMap;function e5(e){let t=e.logger,s=e.logLevel??"off";if(!t)return e2;let r=e4.get(t);if(r&&r[0]===s)return r[1];let n={error:e1("error",t,s),warn:e1("warn",t,s),info:e1("info",t,s),debug:e1("debug",t,s)};return e4.set(t,[s,n]),n}let e6=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class e3{constructor(e,t,s){this.iterator=e,i.set(this,void 0),this.controller=t,ey(this,i,s,"f")}static fromSSEResponse(e,t,s){let r=!1,n=s?e5(s):console;async function*a(){if(r)throw new ek("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(let s of e8(e,t)){if("completion"===s.event)try{yield JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if("message_start"===s.event||"message_delta"===s.event||"message_stop"===s.event||"content_block_start"===s.event||"content_block_delta"===s.event||"content_block_stop"===s.event)try{yield JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if("ping"!==s.event&&"error"===s.event)throw new eS(void 0,eU(s.data)??s.data,void 0,e.headers)}s=!0}catch(e){if(e_(e))return;throw e}finally{s||t.abort()}}return new e3(a,t,s)}static fromReadableStream(e,t,s){let r=!1;async function*n(){let t=new eY;for await(let s of eV(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new e3(async function*(){if(r)throw new ek("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(e_(e))return;throw e}finally{e||t.abort()}},t,s)}[(i=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),r=r=>({next:()=>{if(0===r.length){let r=s.next();e.push(r),t.push(r)}return r.shift()}});return[new e3(()=>r(e),this.controller,ew(this,i,"f")),new e3(()=>r(t),this.controller,ew(this,i,"f"))]}toReadableStream(){let e,t=this;return eB({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:r}=await e.next();if(r)return t.close();let n=eG(JSON.stringify(s)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*e8(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new ek("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new ek("Attempted to iterate over a response with no body")}let s=new e7,r=new eY;for await(let t of e9(eV(e.body)))for(let e of r.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of r.flush()){let t=s.decode(e);t&&(yield t)}}async function*e9(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let r=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?eG(s):s,n=new Uint8Array(t.length+r.length);for(n.set(t),n.set(r,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class e7{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let s;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,a]=-1!==(s=(t=e).indexOf(":"))?[t.substring(0,s),":",t.substring(s+1)]:[t,"",""];return a.startsWith(" ")&&(a=a.substring(1)),"event"===r?this.event=a:"data"===r&&this.data.push(a),null}}async function te(e,t){let{response:s,requestLogID:r,retryOfRequestLogID:n,startTime:a}=t,i=await (async()=>{if(t.options.stream)return(e5(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller):e3.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let r=s.headers.get("content-type"),n=r?.split(";")[0]?.trim();return n?.includes("application/json")||n?.endsWith("+json")?tt(await s.json(),s):await s.text()})();return e5(e).debug(`[${r}] response parsed`,e6({retryOfRequestLogID:n,url:s.url,status:s.status,body:i,durationMs:Date.now()-a})),i}function tt(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("request-id"),enumerable:!1})}class ts extends Promise{constructor(e,t,s=te){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,o.set(this,void 0),ey(this,o,e,"f")}_thenUnwrap(e){return new ts(ew(this,o,"f"),this.responsePromise,async(t,s)=>tt(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(ew(this,o,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}o=new WeakMap;class tr{constructor(e,t,s,r){l.set(this,void 0),ey(this,l,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new ek("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await ew(this,l,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(l=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tn extends ts{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await te(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class ta extends tr{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.first_id=s.first_id||null,this.last_id=s.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let e=this.first_id;return e?{...this.options,query:{...eL(this.options.query),before_id:e}}:null}let e=this.last_id;return e?{...this.options,query:{...eL(this.options.query),after_id:e}}:null}}class ti extends tr{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.next_page=s.next_page||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.next_page;return e?{...this.options,query:{...eL(this.options.query),page:e}}:null}}let to=()=>{if("u"<typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tl(e,t,s){return to(),new File(e,t??"unknown_file",s)}function th(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let tc=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tu=async(e,t)=>({...e,body:await tp(e.body,t)}),td=new WeakMap,tp=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=td.get(t);if(s)return s;let r=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return td.set(t,r),r}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>tf(s,e,t))),s},tf=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response){let r={},n=s.headers.get("Content-Type");n&&(r={type:n}),e.append(t,tl([await s.blob()],th(s),r))}else if(tc(s))e.append(t,tl([await new Response(eJ(s)).blob()],th(s)));else{let r;if((r=s)instanceof Blob&&"name"in r)e.append(t,tl([s],th(s),{type:s.type}));else if(Array.isArray(s))await Promise.all(s.map(s=>tf(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,r])=>tf(e,`${t}[${s}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}}},tm=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function tg(e,t,s){let r,n;if(to(),e=await e,t||(t=th(e)),null!=(r=e)&&"object"==typeof r&&"string"==typeof r.name&&"number"==typeof r.lastModified&&tm(r))return e instanceof File&&null==t&&null==s?e:tl([await e.arrayBuffer()],t??e.name,{type:e.type,lastModified:e.lastModified,...s});if(null!=(n=e)&&"object"==typeof n&&"string"==typeof n.url&&"function"==typeof n.blob){let r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tl(await tb(r),t,s)}let a=await tb(e);if(!s?.type){let e=a.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tl(a,t,s)}async function tb(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(tm(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tc(e))for await(let s of e)t.push(...await tb(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class ty{constructor(e){this._client=e}}let tw=Symbol.for("brand.privateNullableHeaders"),tv=e=>{let t=new Headers,s=new Set;for(let r of e){let e=new Set;for(let[n,a]of function*(e){let t;if(!e)return;if(tw in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let r of(e instanceof Headers?t=e.entries():eC(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=r[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=eC(r[1])?r[1]:[r[1]],n=!1;for(let r of t)void 0!==r&&(s&&!n&&(n=!0,yield[e,null]),yield[e,r])}}(r)){let r=n.toLowerCase();e.has(r)||(t.delete(n),e.add(r)),null===a?(t.delete(n),s.add(r)):(t.append(n,a),s.delete(r))}}return{[tw]:!0,values:t,nulls:s}};function t_(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let tx=Object.freeze(Object.create(null)),tk=((e=t_)=>function(t,...s){let r;if(1===t.length)return t[0];let n=!1,a=[],i=t.reduce((t,r,i)=>{/[?#]/.test(r)&&(n=!0);let o=s[i],l=(n?encodeURIComponent:e)(""+o);return i!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??tx)??tx)?.toString)&&(l=o+"",a.push({start:t.length+r.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+r+(i===s.length?"":l)},""),o=i.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(r=l.exec(o));)a.push({start:r.index,length:r[0].length,error:`Value "${r[0]}" can't be safely passed as a path parameter`});if(a.sort((e,t)=>e.start-t.start),a.length>0){let e=0,t=a.reduce((t,s)=>{let r=" ".repeat(s.start-e),n="^".repeat(s.length);return e=s.start+s.length,t+r+n},"");throw new ek(`Path parameters result in path with invalid segments:
${a.map(e=>e.error).join("\n")}
${i}
${t}`)}return i})(t_);class tS extends ty{list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/files",ta,{query:r,...t,headers:tv([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(tk`/v1/files/${e}`,{...s,headers:tv([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},s?.headers])})}download(e,t={},s){let{betas:r}=t??{};return this._client.get(tk`/v1/files/${e}/content`,{...s,headers:tv([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},s){let{betas:r}=t??{};return this._client.get(tk`/v1/files/${e}`,{...s,headers:tv([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},s?.headers])})}upload(e,t){let{betas:s,...r}=e;return this._client.post("/v1/files",tu({body:r,...t,headers:tv([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])},this._client))}}class tR extends ty{retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tk`/v1/models/${e}?beta=true`,{...s,headers:tv([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/models?beta=true",ta,{query:r,...t,headers:tv([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}let tj={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function tA(e,t,s){return t&&"parse"in(t.output_format??{})?tM(e,t,s):{...e,content:e.content.map(e=>"text"===e.type?Object.defineProperty(Object.defineProperty({...e},"parsed_output",{value:null,enumerable:!1}),"parsed",{get:()=>(s.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),null),enumerable:!1}):e),parsed_output:null}}function tM(e,t,s){let r=null,n=e.content.map(e=>{if("text"===e.type){let n=function(e,t){if(e.output_format?.type!=="json_schema")return null;try{if("parse"in e.output_format)return e.output_format.parse(t);return JSON.parse(t)}catch(e){throw new ek(`Failed to parse structured output: ${e}`)}}(t,e.text);return null===r&&(r=n),Object.defineProperty(Object.defineProperty({...e},"parsed_output",{value:n,enumerable:!1}),"parsed",{get:()=>(s.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),n),enumerable:!1})}return e});return{...e,content:n,parsed_output:r}}let tN=e=>{if(0===e.length)return e;let t=e[e.length-1];switch(t.type){case"separator":return tN(e=e.slice(0,e.length-1));case"number":let s=t.value[t.value.length-1];if("."===s||"-"===s)return tN(e=e.slice(0,e.length-1));case"string":let r=e[e.length-2];if(r?.type==="delimiter"||r?.type==="brace"&&"{"===r.value)return tN(e=e.slice(0,e.length-1));break;case"delimiter":return tN(e=e.slice(0,e.length-1))}return e},tP=e=>{var t;let s,r;return JSON.parse((t=tN((e=>{let t=0,s=[];for(;t<e.length;){let r=e[t];if("\\"===r){t++;continue}if("{"===r){s.push({type:"brace",value:"{"}),t++;continue}if("}"===r){s.push({type:"brace",value:"}"}),t++;continue}if("["===r){s.push({type:"paren",value:"["}),t++;continue}if("]"===r){s.push({type:"paren",value:"]"}),t++;continue}if(":"===r){s.push({type:"separator",value:":"}),t++;continue}if(","===r){s.push({type:"delimiter",value:","}),t++;continue}if('"'===r){let n="",a=!1;for(r=e[++t];'"'!==r;){if(t===e.length){a=!0;break}if("\\"===r){if(++t===e.length){a=!0;break}n+=r+e[t],r=e[++t]}else n+=r,r=e[++t]}r=e[++t],a||s.push({type:"string",value:n});continue}let n=/\s/;if(r&&n.test(r)){t++;continue}let a=/[0-9]/;if(r&&a.test(r)||"-"===r||"."===r){let n="";for("-"===r&&(n+=r,r=e[++t]);r&&a.test(r)||"."===r;)n+=r,r=e[++t];s.push({type:"number",value:n});continue}let i=/[a-z]/i;if(r&&i.test(r)){let n="";for(;r&&i.test(r)&&t!==e.length;)n+=r,r=e[++t];"true"==n||"false"==n||"null"===n?s.push({type:"name",value:n}):t++;continue}t++}return s})(e)),s=[],t.map(e=>{"brace"===e.type&&("{"===e.value?s.push("}"):s.splice(s.lastIndexOf("}"),1)),"paren"===e.type&&("["===e.value?s.push("]"):s.splice(s.lastIndexOf("]"),1))}),s.length>0&&s.reverse().map(e=>{"}"===e?t.push({type:"brace",value:"}"}):"]"===e&&t.push({type:"paren",value:"]"})}),r="",t.map(e=>{"string"===e.type?r+='"'+e.value+'"':r+=e.value}),r))},tT="__json_buf";function t$(e){return"tool_use"===e.type||"server_tool_use"===e.type||"mcp_tool_use"===e.type}class tE{constructor(e,t){h.add(this),this.messages=[],this.receivedMessages=[],c.set(this,void 0),u.set(this,null),this.controller=new AbortController,d.set(this,void 0),p.set(this,()=>{}),f.set(this,()=>{}),m.set(this,void 0),g.set(this,()=>{}),b.set(this,()=>{}),y.set(this,{}),w.set(this,!1),v.set(this,!1),_.set(this,!1),x.set(this,!1),k.set(this,void 0),S.set(this,void 0),R.set(this,void 0),M.set(this,e=>{if(ey(this,v,!0,"f"),e_(e)&&(e=new eR),e instanceof eR)return ey(this,_,!0,"f"),this._emit("abort",e);if(e instanceof ek)return this._emit("error",e);if(e instanceof Error){let t=new ek(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ek(String(e)))}),ey(this,d,new Promise((e,t)=>{ey(this,p,e,"f"),ey(this,f,t,"f")}),"f"),ey(this,m,new Promise((e,t)=>{ey(this,g,e,"f"),ey(this,b,t,"f")}),"f"),ew(this,d,"f").catch(()=>{}),ew(this,m,"f").catch(()=>{}),ey(this,u,e,"f"),ey(this,R,t?.logger??console,"f")}get response(){return ew(this,k,"f")}get request_id(){return ew(this,S,"f")}async withResponse(){ey(this,x,!0,"f");let e=await ew(this,d,"f");if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new tE(null);return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s,{logger:r}={}){let n=new tE(t,{logger:r});for(let e of t.messages)n._addMessageParam(e);return ey(n,u,{...t,stream:!0},"f"),n._run(()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},ew(this,M,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){let r,n=s?.signal;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{ew(this,h,"m",N).call(this);let{response:r,data:n}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();for await(let e of(this._connected(r),n))ew(this,h,"m",P).call(this,e);if(n.controller.signal?.aborted)throw new eR;ew(this,h,"m",T).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(ey(this,k,e,"f"),ey(this,S,e?.headers.get("request-id"),"f"),ew(this,p,"f").call(this,e),this._emit("connect"))}get ended(){return ew(this,w,"f")}get errored(){return ew(this,v,"f")}get aborted(){return ew(this,_,"f")}abort(){this.controller.abort()}on(e,t){return(ew(this,y,"f")[e]||(ew(this,y,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=ew(this,y,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(ew(this,y,"f")[e]||(ew(this,y,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{ey(this,x,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){ey(this,x,!0,"f"),await ew(this,m,"f")}get currentMessage(){return ew(this,c,"f")}async finalMessage(){return await this.done(),ew(this,h,"m",j).call(this)}async finalText(){return await this.done(),ew(this,h,"m",A).call(this)}_emit(e,...t){if(ew(this,w,"f"))return;"end"===e&&(ey(this,w,!0,"f"),ew(this,g,"f").call(this));let s=ew(this,y,"f")[e];if(s&&(ew(this,y,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];ew(this,x,"f")||s?.length||Promise.reject(e),ew(this,f,"f").call(this,e),ew(this,b,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];ew(this,x,"f")||s?.length||Promise.reject(e),ew(this,f,"f").call(this,e),ew(this,b,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",ew(this,h,"m",j).call(this))}async _fromReadableStream(e,t){let s,r=t?.signal;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{ew(this,h,"m",N).call(this),this._connected(null);let t=e3.fromReadableStream(e,this.controller);for await(let e of t)ew(this,h,"m",P).call(this,e);if(t.controller.signal?.aborted)throw new eR;ew(this,h,"m",T).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(c=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,b=new WeakMap,y=new WeakMap,w=new WeakMap,v=new WeakMap,_=new WeakMap,x=new WeakMap,k=new WeakMap,S=new WeakMap,R=new WeakMap,M=new WeakMap,h=new WeakSet,j=function(){if(0===this.receivedMessages.length)throw new ek("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},A=function(){if(0===this.receivedMessages.length)throw new ek("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new ek("stream ended without producing a content block with type=text");return e.join(" ")},N=function(){this.ended||ey(this,c,void 0,"f")},P=function(e){if(this.ended)return;let t=ew(this,h,"m",$).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":t$(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:tI(e.delta)}break}case"message_stop":this._addMessageParam(t),this._addMessage(tA(t,ew(this,u,"f"),{logger:ew(this,R,"f")}),!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":ey(this,c,t,"f")}},T=function(){if(this.ended)throw new ek("stream has ended, this shouldn't happen");let e=ew(this,c,"f");if(!e)throw new ek("request ended without sending any chunks");return ey(this,c,void 0,"f"),tA(e,ew(this,u,"f"),{logger:ew(this,R,"f")})},$=function(e){let t=ew(this,c,"f");if("message_start"===e.type){if(t)throw new ek(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new ek(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.container=e.delta.container,t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,t.context_management=e.context_management,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push(e.content_block),t;case"content_block_delta":{let s=t.content.at(e.index);switch(e.delta.type){case"text_delta":s?.type==="text"&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":s?.type==="text"&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&t$(s)){let r=s[tT]||"";r+=e.delta.partial_json;let n={...s};if(Object.defineProperty(n,tT,{value:r,enumerable:!1,writable:!0}),r)try{n.input=tP(r)}catch(t){let e=new ek(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${t}. JSON: ${r}`);ew(this,M,"f").call(this,e)}t.content[e.index]=n}break;case"thinking_delta":s?.type==="thinking"&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":s?.type==="thinking"&&(t.content[e.index]={...s,signature:e.delta.signature});break;default:tI(e.delta)}return t}}},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("streamEvent",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new e3(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function tI(e){}let tO=`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but completeâ€”err on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`;function tq(){let e,t;return{promise:new Promise((s,r)=>{e=s,t=r}),resolve:e,reject:t}}class tW{constructor(e,t,s){E.add(this),this.client=e,I.set(this,!1),O.set(this,!1),q.set(this,void 0),W.set(this,void 0),C.set(this,void 0),L.set(this,void 0),U.set(this,void 0),D.set(this,0),ey(this,q,{params:{...t,messages:structuredClone(t.messages)}},"f"),ey(this,W,{...s,headers:tv([{"x-stainless-helper":"BetaToolRunner"},s?.headers])},"f"),ey(this,U,tq(),"f")}async *[(I=new WeakMap,O=new WeakMap,q=new WeakMap,W=new WeakMap,C=new WeakMap,L=new WeakMap,U=new WeakMap,D=new WeakMap,E=new WeakSet,F=async function(){let e=ew(this,q,"f").params.compactionControl;if(!e||!e.enabled)return!1;let t=0;if(void 0!==ew(this,C,"f"))try{let e=await ew(this,C,"f");t=e.usage.input_tokens+(e.usage.cache_creation_input_tokens??0)+(e.usage.cache_read_input_tokens??0)+e.usage.output_tokens}catch{return!1}if(t<(e.contextTokenThreshold??1e5))return!1;let s=e.model??ew(this,q,"f").params.model,r=e.summaryPrompt??tO,n=ew(this,q,"f").params.messages;if("assistant"===n[n.length-1].role){let e=n[n.length-1];if(Array.isArray(e.content)){let t=e.content.filter(e=>"tool_use"!==e.type);0===t.length?n.pop():e.content=t}}let a=await this.client.beta.messages.create({model:s,messages:[...n,{role:"user",content:[{type:"text",text:r}]}],max_tokens:ew(this,q,"f").params.max_tokens},{headers:{"x-stainless-helper":"compaction"}});if(a.content[0]?.type!=="text")throw new ek("Expected text response for compaction");return ew(this,q,"f").params.messages=[{role:"user",content:a.content}],!0},Symbol.asyncIterator)](){var e;if(ew(this,I,"f"))throw new ek("Cannot iterate over a consumed stream");ey(this,I,!0,"f"),ey(this,O,!0,"f"),ey(this,L,void 0,"f");try{for(;;){let t;try{if(ew(this,q,"f").params.max_iterations&&ew(this,D,"f")>=ew(this,q,"f").params.max_iterations)break;ey(this,O,!1,"f"),ey(this,L,void 0,"f"),ey(this,D,(e=ew(this,D,"f"),++e),"f"),ey(this,C,void 0,"f");let{max_iterations:s,compactionControl:r,...n}=ew(this,q,"f").params;if(n.stream?(t=this.client.beta.messages.stream({...n},ew(this,W,"f")),ey(this,C,t.finalMessage(),"f"),ew(this,C,"f").catch(()=>{}),yield t):(ey(this,C,this.client.beta.messages.create({...n,stream:!1},ew(this,W,"f")),"f"),yield ew(this,C,"f")),!await ew(this,E,"m",F).call(this)){if(!ew(this,O,"f")){let{role:e,content:t}=await ew(this,C,"f");ew(this,q,"f").params.messages.push({role:e,content:t})}let e=await ew(this,E,"m",X).call(this,ew(this,q,"f").params.messages.at(-1));if(e)ew(this,q,"f").params.messages.push(e);else if(!ew(this,O,"f"))break}}finally{t&&t.abort()}}if(!ew(this,C,"f"))throw new ek("ToolRunner concluded without a message from the server");ew(this,U,"f").resolve(await ew(this,C,"f"))}catch(e){throw ey(this,I,!1,"f"),ew(this,U,"f").promise.catch(()=>{}),ew(this,U,"f").reject(e),ey(this,U,tq(),"f"),e}}setMessagesParams(e){"function"==typeof e?ew(this,q,"f").params=e(ew(this,q,"f").params):ew(this,q,"f").params=e,ey(this,O,!0,"f"),ey(this,L,void 0,"f")}async generateToolResponse(){let e=await ew(this,C,"f")??this.params.messages.at(-1);return e?ew(this,E,"m",X).call(this,e):null}done(){return ew(this,U,"f").promise}async runUntilDone(){if(!ew(this,I,"f"))for await(let e of this);return this.done()}get params(){return ew(this,q,"f").params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}}async function tC(e,t=e.messages.at(-1)){if(!t||"assistant"!==t.role||!t.content||"string"==typeof t.content)return null;let s=t.content.filter(e=>"tool_use"===e.type);return 0===s.length?null:{role:"user",content:await Promise.all(s.map(async t=>{let s=e.tools.find(e=>("name"in e?e.name:e.mcp_server_name)===t.name);if(!s||!("run"in s))return{type:"tool_result",tool_use_id:t.id,content:`Error: Tool '${t.name}' not found`,is_error:!0};try{let e=t.input;"parse"in s&&s.parse&&(e=s.parse(e));let r=await s.run(e);return{type:"tool_result",tool_use_id:t.id,content:r}}catch(e){return{type:"tool_result",tool_use_id:t.id,content:`Error: ${e instanceof Error?e.message:String(e)}`,is_error:!0}}}))}}X=async function(e){return void 0!==ew(this,L,"f")||ey(this,L,tC(ew(this,q,"f").params,e),"f"),ew(this,L,"f")};class tL{constructor(e,t){this.iterator=e,this.controller=t}async *decoder(){let e=new eY;for await(let t of this.iterator)for(let s of e.decode(t))yield JSON.parse(s);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new ek("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new ek("Attempted to iterate over a response with no body")}return new tL(eV(e.body),t)}}class tU extends ty{create(e,t){let{betas:s,...r}=e;return this._client.post("/v1/messages/batches?beta=true",{body:r,...t,headers:tv([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tk`/v1/messages/batches/${e}?beta=true`,{...s,headers:tv([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",ta,{query:r,...t,headers:tv([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(tk`/v1/messages/batches/${e}?beta=true`,{...s,headers:tv([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}cancel(e,t={},s){let{betas:r}=t??{};return this._client.post(tk`/v1/messages/batches/${e}/cancel?beta=true`,{...s,headers:tv([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}async results(e,t={},s){let r=await this.retrieve(e);if(!r.results_url)throw new ek(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);let{betas:n}=t??{};return this._client.get(r.results_url,{...s,headers:tv([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},s?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>tL.fromResponse(t.response,t.controller))}}let tD={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};class tF extends ty{constructor(){super(...arguments),this.batches=new tU(this._client)}create(e,t){let{betas:s,...r}=e;r.model in tD&&console.warn(`The model '${r.model}' is deprecated and will reach end-of-life on ${tD[r.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let n=this._client._options.timeout;if(!r.stream&&null==n){let e=tj[r.model]??void 0;n=this._client.calculateNonstreamingTimeout(r.max_tokens,e)}return this._client.post("/v1/messages?beta=true",{body:r,timeout:n??6e5,...t,headers:tv([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}parse(e,t){return t={...t,headers:tv([{"anthropic-beta":[...e.betas??[],"structured-outputs-2025-11-13"].toString()},t?.headers])},this.create(e,t).then(t=>tM(t,e,{logger:this._client.logger??console}))}stream(e,t){return tE.createMessage(this,e,t)}countTokens(e,t){let{betas:s,...r}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:r,...t,headers:tv([{"anthropic-beta":[...s??[],"token-counting-2024-11-01"].toString()},t?.headers])})}toolRunner(e,t){return new tW(this._client,e,t)}}tF.Batches=tU,tF.BetaToolRunner=tW;class tX extends ty{create(e,t={},s){let{betas:r,...n}=t??{};return this._client.post(tk`/v1/skills/${e}/versions?beta=true`,tu({body:n,...s,headers:tv([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])},this._client))}retrieve(e,t,s){let{skill_id:r,betas:n}=t;return this._client.get(tk`/v1/skills/${r}/versions/${e}?beta=true`,{...s,headers:tv([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e,t={},s){let{betas:r,...n}=t??{};return this._client.getAPIList(tk`/v1/skills/${e}/versions?beta=true`,ti,{query:n,...s,headers:tv([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}delete(e,t,s){let{skill_id:r,betas:n}=t;return this._client.delete(tk`/v1/skills/${r}/versions/${e}?beta=true`,{...s,headers:tv([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},s?.headers])})}}class tB extends ty{constructor(){super(...arguments),this.versions=new tX(this._client)}create(e={},t){let{betas:s,...r}=e??{};return this._client.post("/v1/skills?beta=true",tu({body:r,...t,headers:tv([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])},this._client))}retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tk`/v1/skills/${e}?beta=true`,{...s,headers:tv([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/skills?beta=true",ti,{query:r,...t,headers:tv([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(tk`/v1/skills/${e}?beta=true`,{...s,headers:tv([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}}tB.Versions=tX;class tJ extends ty{constructor(){super(...arguments),this.models=new tR(this._client),this.messages=new tF(this._client),this.files=new tS(this._client),this.skills=new tB(this._client)}}tJ.Models=tR,tJ.Messages=tF,tJ.Files=tS,tJ.Skills=tB;class tV extends ty{create(e,t){let{betas:s,...r}=e;return this._client.post("/v1/complete",{body:r,timeout:this._client._options.timeout??6e5,...t,headers:tv([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}}let tH="__json_buf";function tK(e){return"tool_use"===e.type||"server_tool_use"===e.type}class tG{constructor(){B.add(this),this.messages=[],this.receivedMessages=[],J.set(this,void 0),this.controller=new AbortController,V.set(this,void 0),H.set(this,()=>{}),K.set(this,()=>{}),G.set(this,void 0),z.set(this,()=>{}),Y.set(this,()=>{}),Q.set(this,{}),Z.set(this,!1),ee.set(this,!1),et.set(this,!1),es.set(this,!1),er.set(this,void 0),en.set(this,void 0),eo.set(this,e=>{if(ey(this,ee,!0,"f"),e_(e)&&(e=new eR),e instanceof eR)return ey(this,et,!0,"f"),this._emit("abort",e);if(e instanceof ek)return this._emit("error",e);if(e instanceof Error){let t=new ek(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ek(String(e)))}),ey(this,V,new Promise((e,t)=>{ey(this,H,e,"f"),ey(this,K,t,"f")}),"f"),ey(this,G,new Promise((e,t)=>{ey(this,z,e,"f"),ey(this,Y,t,"f")}),"f"),ew(this,V,"f").catch(()=>{}),ew(this,G,"f").catch(()=>{})}get response(){return ew(this,er,"f")}get request_id(){return ew(this,en,"f")}async withResponse(){ey(this,es,!0,"f");let e=await ew(this,V,"f");if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new tG;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){let r=new tG;for(let e of t.messages)r._addMessageParam(e);return r._run(()=>r._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},ew(this,eo,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){let r,n=s?.signal;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{ew(this,B,"m",el).call(this);let{response:r,data:n}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();for await(let e of(this._connected(r),n))ew(this,B,"m",eh).call(this,e);if(n.controller.signal?.aborted)throw new eR;ew(this,B,"m",ec).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(ey(this,er,e,"f"),ey(this,en,e?.headers.get("request-id"),"f"),ew(this,H,"f").call(this,e),this._emit("connect"))}get ended(){return ew(this,Z,"f")}get errored(){return ew(this,ee,"f")}get aborted(){return ew(this,et,"f")}abort(){this.controller.abort()}on(e,t){return(ew(this,Q,"f")[e]||(ew(this,Q,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=ew(this,Q,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(ew(this,Q,"f")[e]||(ew(this,Q,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{ey(this,es,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){ey(this,es,!0,"f"),await ew(this,G,"f")}get currentMessage(){return ew(this,J,"f")}async finalMessage(){return await this.done(),ew(this,B,"m",ea).call(this)}async finalText(){return await this.done(),ew(this,B,"m",ei).call(this)}_emit(e,...t){if(ew(this,Z,"f"))return;"end"===e&&(ey(this,Z,!0,"f"),ew(this,z,"f").call(this));let s=ew(this,Q,"f")[e];if(s&&(ew(this,Q,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];ew(this,es,"f")||s?.length||Promise.reject(e),ew(this,K,"f").call(this,e),ew(this,Y,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];ew(this,es,"f")||s?.length||Promise.reject(e),ew(this,K,"f").call(this,e),ew(this,Y,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",ew(this,B,"m",ea).call(this))}async _fromReadableStream(e,t){let s,r=t?.signal;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{ew(this,B,"m",el).call(this),this._connected(null);let t=e3.fromReadableStream(e,this.controller);for await(let e of t)ew(this,B,"m",eh).call(this,e);if(t.controller.signal?.aborted)throw new eR;ew(this,B,"m",ec).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(J=new WeakMap,V=new WeakMap,H=new WeakMap,K=new WeakMap,G=new WeakMap,z=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,er=new WeakMap,en=new WeakMap,eo=new WeakMap,B=new WeakSet,ea=function(){if(0===this.receivedMessages.length)throw new ek("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},ei=function(){if(0===this.receivedMessages.length)throw new ek("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new ek("stream ended without producing a content block with type=text");return e.join(" ")},el=function(){this.ended||ey(this,J,void 0,"f")},eh=function(e){if(this.ended)return;let t=ew(this,B,"m",eu).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":tK(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:tz(e.delta)}break}case"message_stop":this._addMessageParam(t),this._addMessage(t,!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":ey(this,J,t,"f")}},ec=function(){if(this.ended)throw new ek("stream has ended, this shouldn't happen");let e=ew(this,J,"f");if(!e)throw new ek("request ended without sending any chunks");return ey(this,J,void 0,"f"),e},eu=function(e){let t=ew(this,J,"f");if("message_start"===e.type){if(t)throw new ek(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new ek(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push({...e.content_block}),t;case"content_block_delta":{let s=t.content.at(e.index);switch(e.delta.type){case"text_delta":s?.type==="text"&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":s?.type==="text"&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&tK(s)){let r=s[tH]||"";r+=e.delta.partial_json;let n={...s};Object.defineProperty(n,tH,{value:r,enumerable:!1,writable:!0}),r&&(n.input=tP(r)),t.content[e.index]=n}break;case"thinking_delta":s?.type==="thinking"&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":s?.type==="thinking"&&(t.content[e.index]={...s,signature:e.delta.signature});break;default:tz(e.delta)}return t}}},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("streamEvent",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new e3(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function tz(e){}class tY extends ty{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(tk`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",ta,{query:e,...t})}delete(e,t){return this._client.delete(tk`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(tk`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let s=await this.retrieve(e);if(!s.results_url)throw new ek(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);return this._client.get(s.results_url,{...t,headers:tv([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>tL.fromResponse(t.response,t.controller))}}class tQ extends ty{constructor(){super(...arguments),this.batches=new tY(this._client)}create(e,t){e.model in tZ&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${tZ[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let s=this._client._options.timeout;if(!e.stream&&null==s){let t=tj[e.model]??void 0;s=this._client.calculateNonstreamingTimeout(e.max_tokens,t)}return this._client.post("/v1/messages",{body:e,timeout:s??6e5,...t,stream:e.stream??!1})}stream(e,t){return tG.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}let tZ={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};tQ.Batches=tY;class t0 extends ty{retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tk`/v1/models/${e}`,{...s,headers:tv([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/models",ta,{query:r,...t,headers:tv([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}let t1=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class t2{constructor({baseURL:e=t1("ANTHROPIC_BASE_URL"),apiKey:t=t1("ANTHROPIC_API_KEY")??null,authToken:s=t1("ANTHROPIC_AUTH_TOKEN")??null,...r}={}){ed.add(this),ef.set(this,void 0);const n={apiKey:t,authToken:s,...r,baseURL:e||"https://api.anthropic.com"};if(!n.dangerouslyAllowBrowser&&"u">typeof window&&void 0!==window.document&&"u">typeof navigator)throw new ek("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Anthropic({ apiKey, dangerouslyAllowBrowser: true });\n");this.baseURL=n.baseURL,this.timeout=n.timeout??ep.DEFAULT_TIMEOUT,this.logger=n.logger??console;const a="warn";this.logLevel=a,this.logLevel=eZ(n.logLevel,"ClientOptions.logLevel",this)??eZ(t1("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??a,this.fetchOptions=n.fetchOptions,this.maxRetries=n.maxRetries??2,this.fetch=n.fetch??function(){if("u">typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),ey(this,ef,eK,"f"),this._options=n,this.apiKey="string"==typeof t?t:null,this.authToken=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.get("x-api-key")||e.get("authorization")||this.apiKey&&e.get("x-api-key")||t.has("x-api-key")||this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return tv([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(null!=this.apiKey)return tv([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(null!=this.authToken)return tv([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new ek(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${eD}`}defaultIdempotencyKey(){return`stainless-node-retry-${ev()}`}makeStatusError(e,t,s,r){return eS.generate(e,t,s,r)}buildURL(e,t,s){let r=!ew(this,ed,"m",em).call(this)&&s||this.baseURL,n=new URL(eq.test(e)?e:r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(a)&&(t={...a,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new ek("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 6e5}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new ts(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let r=await e,n=r.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(r);let{req:a,url:i,timeout:o}=await this.buildRequest(r,{retryCount:n-t});await this.prepareRequest(a,{url:i,options:r});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),h=void 0===s?"":`, retryOf: ${s}`,c=Date.now();if(e5(this).debug(`[${l}] sending request`,e6({retryOfRequestLogID:s,method:r.method,url:i,options:r,headers:a.headers})),r.signal?.aborted)throw new eR;let u=new AbortController,d=await this.fetchWithTimeout(i,a,o,u).catch(ex),p=Date.now();if(d instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new eR;let n=e_(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return e5(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`),e5(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,e6({retryOfRequestLogID:s,url:i,durationMs:p-c,message:d.message})),this.retryRequest(r,t,s??l);if(e5(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`),e5(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,e6({retryOfRequestLogID:s,url:i,durationMs:p-c,message:d.message})),n)throw new eA;throw new ej({cause:d})}let f=[...d.headers.entries()].filter(([e])=>"request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${h}${f}] ${a.method} ${i} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-c}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await eH(d.body),e5(this).info(`${m} - ${e}`),e5(this).debug(`[${l}] response error (${e})`,e6({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-c})),this.retryRequest(r,t,s??l,d.headers)}let n=e?"error; no more retries left":"error; not retryable";e5(this).info(`${m} - ${n}`);let a=await d.text().catch(e=>ex(e).message),i=eU(a),o=i?void 0:a;throw e5(this).debug(`[${l}] response error (${n})`,e6({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-c})),this.makeStatusError(d.status,i,o,d.headers)}return e5(this).info(m),e5(this).debug(`[${l}] response start`,e6({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-c})),{response:d,options:r,controller:u,requestLogID:l,retryOfRequestLogID:s,startTime:c}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new tn(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,r){let{signal:n,method:a,...i}=t||{};n&&n.addEventListener("abort",()=>r.abort());let o=setTimeout(()=>r.abort(),s),l=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||"object"==typeof i.body&&null!==i.body&&Symbol.asyncIterator in i.body,h={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...i};a&&(h.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,h)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s,r){let n,a,i=r?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(n=e)}let o=r?.get("retry-after");if(o&&!n){let e=parseFloat(o);n=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await (a=n,new Promise(e=>setTimeout(e,a))),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||null!=t&&e>t)throw new ek("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:r,path:n,query:a,defaultBaseURL:i}=s,o=this.buildURL(n,a,i);"timeout"in s&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new ek(`${e} must be an integer`);if(t<0)throw new ek(`${e} must be a positive integer`)})("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:h}=this.buildBody({options:s}),c=await this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:c,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&h instanceof globalThis.ReadableStream&&{duplex:"half"},...h&&{body:h},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:s,bodyHeaders:r,retryCount:n}){let a={};this.idempotencyHeader&&"get"!==s&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);let i=tv([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...t??(t=(()=>{let e="u">typeof Deno&&null!=Deno.build?"deno":"u">typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eD,"X-Stainless-OS":eX(Deno.build.os),"X-Stainless-Arch":eF(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("u">typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eD,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eD,"X-Stainless-OS":eX(globalThis.process.platform??"unknown"),"X-Stainless-Arch":eF(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("u"<typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,r=s[2]||0,n=s[3]||0;return{browser:e,version:`${t}.${r}.${n}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eD,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eD,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=tv([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:eJ(e)}:ew(this,ef,"f").call(this,{body:e,headers:s})}}ep=t2,ef=new WeakMap,ed=new WeakSet,em=function(){return"https://api.anthropic.com"!==this.baseURL},t2.Anthropic=ep,t2.HUMAN_PROMPT="\\n\\nHuman:",t2.AI_PROMPT="\\n\\nAssistant:",t2.DEFAULT_TIMEOUT=6e5,t2.AnthropicError=ek,t2.APIError=eS,t2.APIConnectionError=ej,t2.APIConnectionTimeoutError=eA,t2.APIUserAbortError=eR,t2.NotFoundError=eT,t2.ConflictError=e$,t2.RateLimitError=eI,t2.BadRequestError=eM,t2.AuthenticationError=eN,t2.InternalServerError=eO,t2.PermissionDeniedError=eP,t2.UnprocessableEntityError=eE,t2.toFile=tg;class t4 extends t2{constructor(){super(...arguments),this.completions=new tV(this),this.messages=new tQ(this),this.models=new t0(this),this.beta=new tJ(this)}}t4.Completions=tV,t4.Messages=tQ,t4.Models=t0,t4.Beta=tJ;let t5=`You are Alex Svanevik, CEO and co-founder of Nansen. Your mission: democratize onchain intelligence and make agentic trading accessible to everyone, not just the whales.

## Tone Rules

- **Direct.** No hedging. State your position. If the data says something, say it.
- **No fluff.** Skip the pleasantries and corporate speak.
- **Data-centric.** Every claim should be backed by onchain evidence or verifiable metrics. "Trust me bro" is not a source.
- **Skeptical of legacy systems.** Traditional finance loves high fees, opacity, and gatekeeping. Challenge these defaults. DeFi exists to fix this.
- **Builder mentality.** Talk about what's being built, not what's being hyped. Vaporware is dead. Real products win.

## Formatting Rules

- **No em dashes.** Use commas or start a new sentence instead.
- **"Onchain" not "on-chain."** Always one word, no hyphen.
- **Short, declarative sentences.** No compound hedging.
- **Colons before key statements** or lists.
- **No emojis** unless explicitly requested.

## Sentence Structure

- **Open with a reframe.** Don't agree with flawed premises. ("The framing of X is outdated. The real question is...")
- **Lead with hard numbers.** ("85%+ quality scores in Expert Mode. GPT-5? Around 20%.")
- **Name competitors directly** when the data supports it.
- **End with practical advice.** ("Try it. Ask it real questions. See whether the answers are grounded.")
- **Trust the user's judgment.** ("Generally, users are good judges of quality.")

## Voice Characteristics

- Use "we" when referring to Nansen's work; use "I" for personal takes
- Comfortable calling out bad actors and poor data practices
- Bullish on transparency, onchain verification, and permissionless access
- Not afraid to say most AI trading products will fail (80-90% will underperform)
- Prefer "vibe trading" over complex dashboards. Simplicity scales.
- Use "religiously" as an intensifier when describing rigorous processes

## Technical Language

- Specific test categories: wallet identification, token discovery, due diligence, portfolio analysis
- Stack transparency: "We use foundation models as part of our stack, constantly benchmark them, then fine-tune and extend them with onchain capabilities."
- Routing logic: "We route certain prompts to specific models based on what they're optimized for."
- Key differentiator: "The intelligence is baked into our system, not just retrieved from a data layer."

## Current 2026 Context

### Agentic Trading Launch
Nansen has shipped AI-powered trading functionality across web and mobile. This marks the shift from analytics-only tooling to what we call **agentic trading**, moving from insight to execution in a single interface.

- Live on Base and Solana with MetaDEX routing for best prices
- "Vibe trading" paradigm: conversational AI replaces complex dashboards
- The agent can independently discover, vet, and execute trades using Nansen's onchain data
- Goal: make onchain trading accessible to 100x more users
- Built-in safeguards against AI hallucinations. This isn't another GPT wrapper.

### 2026 Roadmap Highlights
- Frictionless trading with low fees on both mobile and web
- Nansen AI mobile app evolving into a full-stack onchain trading product
- Terminal trading + agentic trading integrated into the same experience
- First Joint Venture Protocol (JVP) launching in 2026. Going beyond data to co-create infrastructure for the future of finance.

### The Super App Vision
Nansen is building the definitive Information Super-App of Web3:
- 500M+ labeled wallets across multiple chains
- Token God Mode and Smart Money tracking
- Portfolio tracking across 17+ blockchains and 100+ protocols (EVM and non-EVM)
- Nansen Connect for Web3 messaging
- From research to analysis to execution, all in one place

### Market Take
Most AI trading products shipping in 2026 will fail. Estimated 80-90% will underperform or lose users money due to weak data understanding and model misjudgments. The vaporware token era is over. Real products with real data win now.

### Key Partnerships
- Privy: Non-custodial wallet infrastructure, client-side key management
- Jupiter: Solana DEX aggregation
- LI.FI: Cross-chain routing
- OKX: Additional DEX integration

### Safety & Custody Stance
- Every trade requires explicit user confirmation
- AI agent does not control funds
- "You hold your keys. Nansen never has access to them."
- Transparent routing through trusted DEX aggregators with full onchain visibility

## Singapore Regulatory Considerations

When drafting public statements, avoid:

| Avoid | Reason | Use Instead |
|-------|--------|-------------|
| Performance guarantees ("won't lose money") | MAS PS-G02 violation | "We believe our approach offers a more considered path forward" |
| "Alpha" terminology | Investment advice implications under FAA | "Opportunities" |
| "Vaporware" accusations | Defamation risk | "Products lacking data foundation" |
| "Actually works" | Absolute performance claims | "Designed to deliver actionable intelligence" |
| "Unfair advantage" | Aggressive positioning | "Competitive edge" |
| "This is what responsible AI trading looks like" | Overclaims compliance | "This is our approach to responsible AI-assisted trading" |

Key regulations:
- MAS Guidelines PS-G02 (Digital Payment Token Services)
- Financial Advisers Act (FAA)
- MAS AI Risk Management Guidelines (Nov 2025)

## Response Format

You must provide THREE versions of your response:

1. **Version 1 (1 paragraph):** Tight, punchy, for quick soundbites. Maximum 4-5 sentences.

2. **Version 2 (2 paragraphs):** Core argument with landing point. This is often the best choice for conceptual questions.

3. **Version 3 (3+ paragraphs):** Full context with benchmarks and technical detail. Best for product-specific or technical questions.

Also provide a **Recommendation** on which version to use based on the question type.

Your output must be valid JSON in this exact format:
{
  "version1": "Your 1-paragraph response here",
  "version2": "Your 2-paragraph response here",
  "version3": "Your 3+ paragraph response here",
  "recommendation": "Version X is recommended because..."
}`;function t6(){let[e,t]=(0,eb.useState)(!1),[s,r]=(0,eb.useState)(""),[n,a]=(0,eb.useState)(""),[i,o]=(0,eb.useState)(""),[l,h]=(0,eb.useState)(!1),[c,u]=(0,eb.useState)("single"),[d,p]=(0,eb.useState)(""),[f,m]=(0,eb.useState)(""),[g,b]=(0,eb.useState)([]),[y,w]=(0,eb.useState)(!1),[v,_]=(0,eb.useState)("");(0,eb.useEffect)(()=>{let e=localStorage.getItem("anthropic_api_key");e&&(o(e),h(!0))},[]);let x=async e=>{e.preventDefault(),w(!0),_(""),b([]);let t="single"===c?[d.trim()]:f.split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(0===t.length){_("Please enter at least one question"),w(!1);return}try{let e=new t4({apiKey:i,dangerouslyAllowBrowser:!0}),s=[];for(let r of t){let t=(await e.messages.create({model:"claude-sonnet-4-20250514",max_tokens:4096,system:t5,messages:[{role:"user",content:`Journalist question: "${r}"

Generate a response as Alex Svanevik in all three versions. Remember to follow all tone rules, formatting rules, and regulatory considerations. Output valid JSON only.`}]})).content[0];if("text"===t.type){let e=t.text.match(/\{[\s\S]*\}/);if(e){let t=JSON.parse(e[0]);s.push({question:r,response:t})}}}b(s)}catch(e){_(e instanceof Error?e.message:"An error occurred")}finally{w(!1)}};return e?l?(0,eg.jsxs)("div",{className:"min-h-screen bg-[#0a0a0a] text-white",children:[(0,eg.jsx)("header",{className:"bg-[#141414] border-b border-[#2a2a2a] sticky top-0 z-10",children:(0,eg.jsxs)("div",{className:"max-w-5xl mx-auto px-6 py-4 flex items-center justify-between",children:[(0,eg.jsx)("h1",{className:"text-lg font-semibold",children:"Alex PR Attributer"}),(0,eg.jsxs)("div",{className:"flex items-center gap-3",children:[(0,eg.jsx)("span",{className:"text-xs text-[#a0a0a0] bg-[#1a1a1a] px-3 py-1 rounded-full border border-[#2a2a2a]",children:"Nansen Internal"}),(0,eg.jsx)("button",{onClick:()=>{localStorage.removeItem("anthropic_api_key"),o(""),h(!1)},className:"text-xs text-[#606060] hover:text-white transition-colors",children:"Change API Key"})]})]})}),(0,eg.jsxs)("main",{className:"max-w-5xl mx-auto px-6 py-8",children:[(0,eg.jsxs)("form",{onSubmit:x,className:"mb-8",children:[(0,eg.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,eg.jsx)("button",{type:"button",onClick:()=>u("single"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"single"===c?"bg-blue-600 text-white":"bg-[#1a1a1a] text-[#a0a0a0] hover:text-white"}`,children:"Single Question"}),(0,eg.jsx)("button",{type:"button",onClick:()=>u("multiple"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"multiple"===c?"bg-blue-600 text-white":"bg-[#1a1a1a] text-[#a0a0a0] hover:text-white"}`,children:"Multiple Questions"})]}),"single"===c?(0,eg.jsx)("textarea",{value:d,onChange:e=>p(e.target.value),placeholder:"Enter the journalist's question...",className:"w-full h-32 p-4 bg-[#141414] border border-[#2a2a2a] rounded-lg text-white placeholder-[#606060] focus:outline-none focus:border-blue-500 resize-none"}):(0,eg.jsx)("textarea",{value:f,onChange:e=>m(e.target.value),placeholder:"Enter multiple questions, one per line...",className:"w-full h-48 p-4 bg-[#141414] border border-[#2a2a2a] rounded-lg text-white placeholder-[#606060] focus:outline-none focus:border-blue-500 resize-none"}),(0,eg.jsx)("button",{type:"submit",disabled:y,className:"mt-4 px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors",children:y?"Generating...":"Generate Responses"}),v&&(0,eg.jsx)("p",{className:"text-red-500 mt-4 text-sm",children:v})]}),g.length>0&&(0,eg.jsx)("div",{className:"space-y-8",children:g.map((e,t)=>(0,eg.jsxs)("div",{className:"bg-[#141414] border border-[#2a2a2a] rounded-xl overflow-hidden",children:[(0,eg.jsxs)("div",{className:"bg-[#1a1a1a] px-6 py-4 border-b border-[#2a2a2a]",children:[(0,eg.jsx)("h3",{className:"text-sm text-[#a0a0a0] mb-1",children:"Journalist Question"}),(0,eg.jsx)("p",{className:"text-white",children:e.question})]}),(0,eg.jsxs)("div",{className:"p-6",children:[(0,eg.jsx)("div",{className:"mb-4 p-3 bg-blue-600/10 border border-blue-600/30 rounded-lg",children:(0,eg.jsxs)("p",{className:"text-blue-400 text-sm",children:[(0,eg.jsx)("strong",{children:"Recommendation:"})," ",e.response.recommendation]})}),(0,eg.jsxs)("div",{className:"space-y-6",children:[(0,eg.jsx)(t3,{title:"Version 1 (1 paragraph)",content:e.response.version1}),(0,eg.jsx)(t3,{title:"Version 2 (2 paragraphs)",content:e.response.version2}),(0,eg.jsx)(t3,{title:"Version 3 (3+ paragraphs)",content:e.response.version3})]})]})]},t))})]})]}):(0,eg.jsx)("div",{className:"min-h-screen bg-[#0a0a0a] flex items-center justify-center p-4",children:(0,eg.jsxs)("form",{onSubmit:e=>{e.preventDefault(),i.startsWith("sk-ant-")?(localStorage.setItem("anthropic_api_key",i),h(!0)):_("Invalid API key format. Should start with sk-ant-")},className:"bg-[#141414] border border-[#2a2a2a] rounded-xl p-12 w-full max-w-md text-center",children:[(0,eg.jsx)("h1",{className:"text-2xl font-semibold text-white mb-2",children:"Anthropic API Key"}),(0,eg.jsx)("p",{className:"text-[#a0a0a0] mb-6 text-sm",children:"Enter your API key. It stays in your browser only."}),(0,eg.jsx)("input",{type:"password",value:i,onChange:e=>o(e.target.value),placeholder:"sk-ant-...",className:"w-full p-3 bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg text-white mb-4 focus:outline-none focus:border-blue-500 font-mono text-sm",autoFocus:!0}),(0,eg.jsx)("button",{type:"submit",className:"w-full p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Save Key"}),v&&(0,eg.jsx)("p",{className:"text-red-500 mt-4 text-sm",children:v}),(0,eg.jsxs)("p",{className:"text-[#606060] mt-4 text-xs",children:["Get a key at"," ",(0,eg.jsx)("a",{href:"https://console.anthropic.com/",target:"_blank",className:"text-blue-400 hover:underline",children:"console.anthropic.com"})]})]})}):(0,eg.jsx)("div",{className:"min-h-screen bg-[#0a0a0a] flex items-center justify-center p-4",children:(0,eg.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"hokku123"===s?(t(!0),a("")):a("Incorrect password")},className:"bg-[#141414] border border-[#2a2a2a] rounded-xl p-12 w-full max-w-md text-center",children:[(0,eg.jsx)("h1",{className:"text-2xl font-semibold text-white mb-2",children:"Alex PR Attributer"}),(0,eg.jsx)("p",{className:"text-[#a0a0a0] mb-6 text-sm",children:"Enter password to access"}),(0,eg.jsx)("input",{type:"password",value:s,onChange:e=>r(e.target.value),placeholder:"Password",className:"w-full p-3 bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg text-white mb-4 focus:outline-none focus:border-blue-500",autoFocus:!0}),(0,eg.jsx)("button",{type:"submit",className:"w-full p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Access"}),n&&(0,eg.jsx)("p",{className:"text-red-500 mt-4 text-sm",children:n})]})})}function t3({title:e,content:t}){let[s,r]=(0,eb.useState)(!1),n=async()=>{await navigator.clipboard.writeText(t),r(!0),setTimeout(()=>r(!1),2e3)};return(0,eg.jsxs)("div",{children:[(0,eg.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,eg.jsx)("h4",{className:"text-sm font-medium text-[#a0a0a0]",children:e}),(0,eg.jsx)("button",{onClick:n,className:"text-xs text-blue-400 hover:text-blue-300 transition-colors",children:s?"Copied!":"Copy"})]}),(0,eg.jsx)("div",{className:"bg-[#0a0a0a] p-4 rounded-lg border border-[#2a2a2a]",children:(0,eg.jsx)("p",{className:"text-[#e0e0e0] whitespace-pre-wrap leading-relaxed",children:t})})]})}e.s(["default",()=>t6],52683)}]);